<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>构建 .pex 文件 &mdash; pex 2.1.74 文档</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="PEX Recipes and Notes" href="recipes.html" />
    <link rel="prev" title="什么是 .pex 文件？" href="whatispex.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> pex
          </a>
              <div class="version">
                2.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whatispex.html">什么是 .pex 文件？</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">构建 .pex 文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="#invoking-the-pex-utility">调用 <code class="docutils literal notranslate"><span class="pre">pex</span></code> 工具</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#specifying-requirements">指定要求</a></li>
<li class="toctree-l2"><a class="reference internal" href="#specifying-entry-points">指定入口点</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pex-options-script-py">pex &lt;options&gt; – script.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pex-m">pex -m</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pex-c">pex -c</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#saving-pex-files">保存 .pex 文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tailoring-requirement-resolution">Tailoring requirement resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tailoring-pex-execution-at-build-time">Tailoring PEX execution at build time</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#zip-safe-not-zip-safe"><code class="docutils literal notranslate"><span class="pre">--zip-safe</span></code>/<code class="docutils literal notranslate"><span class="pre">--not-zip-safe</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#always-write-cache"><code class="docutils literal notranslate"><span class="pre">--always-write-cache</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#inherit-path"><code class="docutils literal notranslate"><span class="pre">--inherit-path</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#ignore-errors"><code class="docutils literal notranslate"><span class="pre">--ignore-errors</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#platform"><code class="docutils literal notranslate"><span class="pre">--platform</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#complete-platform"><code class="docutils literal notranslate"><span class="pre">--complete-platform</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tailoring-pex-execution-at-runtime">Tailoring PEX execution at runtime</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#using-bdist-pex">Using <code class="docutils literal notranslate"><span class="pre">bdist_pex</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#bdist-pex"><code class="docutils literal notranslate"><span class="pre">bdist_pex</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#bdist-pex-bdist-all"><code class="docutils literal notranslate"><span class="pre">bdist_pex</span> <span class="pre">--bdist-all</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#using-pants">Using Pants</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">PEX Recipes and Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/vars.html">PEX runtime environment variables</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pex</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>构建 .pex 文件</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/buildingpex.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="building-pex-files">
<span id="buildingpex"></span><h1>构建 .pex 文件<a class="headerlink" href="#building-pex-files" title="永久链接至标题">¶</a></h1>
<p>你可以使用 <code class="docutils literal notranslate"><span class="pre">pex</span></code> 工具建立 .pex 文件，该工具在你 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pex</span></code> 时可用。在 virtualenv 中这样做，然后你可以使用 pex 来启动自己：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pex pex requests -c pex -o ~/bin/pex
</pre></div>
</div>
<p>这个命令创建了一个包含 pex 和 requests 的 pex 文件，使用名为 “pex” 的控制台脚本，将其保存在 ~/bin/pex。在这一点上，假设 ~/bin 在你的 $PATH 上，那么你可以在任何 virtualenv 内或外使用 pex。</p>
<p>构建 .pex 文件的第二个最简单的方法是使用 <code class="docutils literal notranslate"><span class="pre">bdist_pex</span></code> setuptools 命令，如果你 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pex</span></code> 就可以使用。例如，从源代码克隆和构建 pip：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git clone https://github.com/pypa/pip <span class="o">&amp;&amp;</span> <span class="nb">cd</span> pip
<span class="gp">$ </span>python setup.py bdist_pex
<span class="go">running bdist_pex</span>
<span class="go">Writing pip to dist/pip-7.2.0.dev0.pex</span>
</pre></div>
</div>
<p>下面对这两种情况进行了更详细的描述。</p>
</section>
<section id="invoking-the-pex-utility">
<h1>调用 <code class="docutils literal notranslate"><span class="pre">pex</span></code> 工具<a class="headerlink" href="#invoking-the-pex-utility" title="永久链接至标题">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">pex</span></code> 工具没有必要的参数，默认情况下会构建一个空环境并调用它。当没有指定入口点时，”invocation” 意味着启动一个解释器：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pex
<span class="go">Python 3.6.2 (default, Jul 20 2017, 03:52:27)</span>
<span class="go">[GCC 7.1.1 20170630] on linux</span>
<span class="go">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span>
<span class="gp gp-VirtualEnv">(InteractiveConsole)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>这创建了一个短暂的环境，只存在于 <code class="docutils literal notranslate"><span class="pre">pex</span></code> 命令调用的时间内，并在退出时立即被垃圾回收。</p>
<p>你可以通过指定 <code class="docutils literal notranslate"><span class="pre">--python=PATH</span></code> 来定制使用哪个解释器。PATH 可以是 Python 二进制文件的绝对路径，也可以是环境中 Python 解释器的名称，例如</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pex
<span class="go">Python 3.6.2 (default, Jul 20 2017, 03:52:27)</span>
<span class="go">[GCC 7.1.1 20170630] on linux</span>
<span class="go">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span>
<span class="gp gp-VirtualEnv">(InteractiveConsole)</span>
<span class="go">&gt;&gt;&gt; print &quot;This won&#39;t work!&quot;</span>
<span class="go">  File &quot;&lt;console&gt;&quot;, line 1</span>
<span class="go">    print &quot;This won&#39;t work!&quot;</span>
<span class="go">                           ^</span>
<span class="go">SyntaxError: Missing parentheses in call to &#39;print&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">$ </span>pex --python<span class="o">=</span>python2.7
<span class="go">Python 2.7.13 (default, Jul 21 2017, 03:24:34)</span>
<span class="go">[GCC 7.1.1 20170630] on linux2</span>
<span class="go">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span>
<span class="gp gp-VirtualEnv">(InteractiveConsole)</span>
<span class="go">&gt;&gt;&gt; print &quot;This works.&quot;</span>
<span class="go">This works.</span>
</pre></div>
</div>
<section id="specifying-requirements">
<h2>指定要求<a class="headerlink" href="#specifying-requirements" title="永久链接至标题">¶</a></h2>
<p>要求使用与 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 和 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 预期相同的形式来指定，例如 <code class="docutils literal notranslate"><span class="pre">flask</span></code>，<code class="docutils literal notranslate"><span class="pre">setuptools==2.1.2</span></code>，<code class="docutils literal notranslate"><span class="pre">Django&gt;=1.4,&lt;1.6</span></code>。这些被指定为 pex 的参数，可以指定任何数字（包括 0）。例如，要启动一个带有 <code class="docutils literal notranslate"><span class="pre">flask</span></code> 和 <code class="docutils literal notranslate"><span class="pre">psutil&gt;1</span></code> 的环境：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pex flask <span class="s1">&#39;psutil&gt;1&#39;</span>
<span class="go">Python 3.6.2 (default, Jul 20 2017, 03:52:27)</span>
<span class="go">[GCC 7.1.1 20170630] on linux</span>
<span class="go">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span>
<span class="gp gp-VirtualEnv">(InteractiveConsole)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>然后你可以像其他方式一样导入和操作模块：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;&gt;&gt; import flask</span>
<span class="go">&gt;&gt;&gt; import psutil</span>
<span class="go">&gt;&gt;&gt; ...</span>
</pre></div>
</div>
<p>方便的是，<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">freeze</span></code> 的输出（一个被钉住的依赖列表）可以直接传递给 <code class="docutils literal notranslate"><span class="pre">pex</span></code>。这提供了一个方便的方法，可以将虚拟环境冻结到 PEX 文件中。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pex <span class="k">$(</span>pip freeze<span class="k">)</span> -o my_application.pex
</pre></div>
</div>
<p>也可以使用 <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> 文件，就像使用 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 一样。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pex -r requirements.txt -o my_application.pex
</pre></div>
</div>
</section>
<section id="specifying-entry-points">
<h2>指定入口点<a class="headerlink" href="#specifying-entry-points" title="永久链接至标题">¶</a></h2>
<p>入口点定义了环境的执行方式，可以用三种方式之一来指定。</p>
<section id="pex-options-script-py">
<h3>pex &lt;options&gt; – script.py<a class="headerlink" href="#pex-options-script-py" title="永久链接至标题">¶</a></h3>
<p>如上所述，如果没有指定入口点，默认行为是模拟一个解释器。首先我们创建一个简单的 flask 应用程序：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat &lt;&lt;EOF &gt; flask_hello_world.py
<span class="go">&gt; from flask import Flask</span>
<span class="go">&gt; app = Flask(__name__)</span>
<span class="go">&gt;</span>
<span class="go">&gt; @app.route(&#39;/&#39;)</span>
<span class="go">&gt; def hello_world():</span>
<span class="go">&gt;   return &#39;hello world!&#39;</span>
<span class="go">&gt;</span>
<span class="go">&gt; app.run()</span>
<span class="go">&gt; EOF</span>
</pre></div>
</div>
<p>然后，像一个解释器一样，如果一个源文件被指定为 pex 的参数，它就会被调用：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pex flask -- ./flask_hello_world.py
<span class="go">* Running on http://127.0.0.1:5000/</span>
</pre></div>
</div>
</section>
<section id="pex-m">
<h3>pex -m<a class="headerlink" href="#pex-m" title="永久链接至标题">¶</a></h3>
<p>你的代码可能在 PEX 文件中，也可能是标准库中的某个预定的入口点。<code class="docutils literal notranslate"><span class="pre">pex</span> <span class="pre">-m</span></code> 的行为与 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span></code> 非常相似。考虑一下 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pydoc</span></code>：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python -m pydoc
<span class="go">pydoc - the Python documentation tool</span>

<span class="go">pydoc.py &lt;name&gt; ...</span>
<span class="go">    Show text documentation on something.  &lt;name&gt; may be the name of a</span>
<span class="go">    Python keyword, topic, function, module, or package, or a dotted</span>
<span class="go">    reference to a class or function within a module or module in a</span>
<span class="go">    ...</span>
</pre></div>
</div>
<p>这可以用 <code class="docutils literal notranslate"><span class="pre">-m</span> <span class="pre">pydoc</span></code> 的 <code class="docutils literal notranslate"><span class="pre">pex</span></code> 工具来模拟。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pex -m pydoc
<span class="go">pydoc - the Python documentation tool</span>

<span class="go">tmpInGItD &lt;name&gt; ...</span>
<span class="go">    Show text documentation on something.  &lt;name&gt; may be the name of a</span>
<span class="go">    Python keyword, topic, function, module, or package, or a dotted</span>
<span class="go">    reference to a class or function within a module or module in a</span>
<span class="go">    ...</span>
</pre></div>
</div>
<p>参数将在命令行的 <code class="docutils literal notranslate"><span class="pre">--</span></code> 后面不加转义地传递。 因此，为了在 Flask 中的 <code class="docutils literal notranslate"><span class="pre">flask.app</span></code> 包上获得 pydoc 帮助：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pex flask -m pydoc -- flask.app

<span class="go">Help on module flask.app in flask:</span>

<span class="go">NAME</span>
<span class="go">    flask.app</span>

<span class="go">FILE</span>
<span class="go">    /private/var/folders/rd/_tjz8zts3g14md1kmf38z6w80000gn/T/tmp3PCy5a/.deps/Flask-0.10.1-py2-none-any.whl/flask/app.py</span>

<span class="go">DESCRIPTION</span>
<span class="go">    flask.app</span>
<span class="go">    ~~~~~~~~~</span>
</pre></div>
</div>
<p>诸如此类。</p>
<p>入口点也可以采取 <code class="docutils literal notranslate"><span class="pre">package:target</span></code> 的形式，比如 <code class="docutils literal notranslate"><span class="pre">sphinx:main</span></code> 或 <code class="docutils literal notranslate"><span class="pre">fabric.main:main</span></code> 分别代表 Sphinx 和 Fabric。这大致相当于运行一个脚本，做 <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">sys,</span> <span class="pre">from</span> <span class="pre">package</span> <span class="pre">import</span> <span class="pre">target;</span> <span class="pre">sys.exit(target())</span></code>。</p>
<p>这可能是调用 Python 应用程序的一种强大方式，而不需要 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> 任何东西，例如一次性调用 Sphinx 的 readthedocs 主题可用：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pex <span class="nv">sphinx</span><span class="o">==</span><span class="m">1</span>.2.2 sphinx_rtd_theme -e sphinx:main -- --help
<span class="go">Sphinx v1.2.2</span>
<span class="go">Usage: /tmp/tmpydcp6kox [options] sourcedir outdir [filenames...]</span>

<span class="go">General options</span>
<span class="go">^^^^^^^^^^^^^^^</span>
<span class="go">-b &lt;builder&gt;  builder to use; default is html</span>
<span class="go">-a            write all files; default is to only write new and changed files</span>
<span class="go">-E            don&#39;t use a saved environment, always read all files</span>
<span class="go">...</span>
</pre></div>
</div>
<p>尽管 sys.exit 被盲目地应用于目标函数的返回值，但由于 <code class="docutils literal notranslate"><span class="pre">sys.exit</span></code> 语义非常灵活，这可能会达到你想要的效果。请咨询你的目标函数和 <a class="reference external" href="https://docs.python.org/library/sys.html#sys.exit">sys.exit</a> 文档以确定。</p>
<p>几乎可以肯定的是，你可以选择指定一个由应用程序导出的控制台脚本，如下文所述。</p>
</section>
<section id="pex-c">
<h3>pex -c<a class="headerlink" href="#pex-c" title="永久链接至标题">¶</a></h3>
<p>如果你不知道你喜欢的 python 包的控制台脚本的 <code class="docutils literal notranslate"><span class="pre">package:target</span></code>，pex 允许你使用 <code class="docutils literal notranslate"><span class="pre">-c</span></code> 来指定一个由发行版定义的控制台脚本。例如，Fabric 在 pip 安装时提供了 <code class="docutils literal notranslate"><span class="pre">fab</span></code> 工具：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pex Fabric -c fab -- --help
<span class="go">Fatal error: Couldn&#39;t find any fabfiles!</span>

<span class="go">Remember that -f can be used to specify fabfile path, and use -h for help.</span>

<span class="go">Aborting.</span>
</pre></div>
</div>
<p>即使是由发行版的 “scripts” 部分定义的脚本也可以使用，例如，用 boto：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pex boto -c mturk
<span class="go">usage: mturk [-h] [-P] [--nicknames PATH]</span>
<span class="go">             {bal,hit,hits,new,extend,expire,rm,as,approve,reject,unreject,bonus,notify,give-qual,revoke-qual}</span>
<span class="go">             ...</span>
<span class="go">mturk: error: too few arguments</span>
</pre></div>
</div>
<p>注意：如果你运行 <code class="docutils literal notranslate"><span class="pre">pex</span> <span class="pre">-c</span></code>，遇到类似 <code class="docutils literal notranslate"><span class="pre">pex.pex_builder.InvalidExecutableSpecification:</span> <span class="pre">Could</span> <span class="pre">not</span> <span class="pre">find</span> <span class="pre">script</span> <span class="pre">'mainscript.py'</span> <span class="pre">in</span> <span class="pre">any</span> <span class="pre">distribution</span> <span class="pre">within</span> <span class="pre">PEX!</span></code> 这样的错误，请仔细检查你的 setup.py，确保 <code class="docutils literal notranslate"><span class="pre">mainscript.py</span></code> 包含在你的 setup 的 <code class="docutils literal notranslate"><span class="pre">scripts</span></code> 阵列中。如果你使用 <code class="docutils literal notranslate"><span class="pre">console_scripts</span></code> 并遇到这个错误，请仔细检查你的 <code class="docutils literal notranslate"><span class="pre">console_scripts</span></code> 语法 - 关于 <code class="docutils literal notranslate"><span class="pre">scripts</span></code> 和 <code class="docutils literal notranslate"><span class="pre">console_scripts</span></code> 的进一步信息可以在 <a class="reference external" href="https://python-packaging.readthedocs.io/en/latest/command-line-scripts.html">Python 打包文档</a> 中找到。</p>
</section>
</section>
<section id="saving-pex-files">
<h2>保存 .pex 文件<a class="headerlink" href="#saving-pex-files" title="永久链接至标题">¶</a></h2>
<p>上面的每个命令都在操纵短暂的 PEX 环境–这些环境只在 pex 命令的有效期内存在，并立即被垃圾回收。</p>
<p>如果指定了 <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">PATH</span></code> 选项，环境的 PEX 文件就会保存在磁盘的 <code class="docutils literal notranslate"><span class="pre">PATH</span></code> 处。例如，我们可以像上面那样打包一个独立的 Sphinx：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pex sphinx sphinx_rtd_theme -c sphinx -o sphinx.pex
</pre></div>
</div>
<p>而不是执行环境，它被保存到磁盘：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls -l sphinx.pex
<span class="go">-rwxr-xr-x  1 wickman  wheel  4988494 Mar 11 17:48 sphinx.pex</span>
</pre></div>
</div>
<p>这是一个可执行的环境，可以像以前一样执行：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./sphinx.pex --help
<span class="go">Sphinx v1.2.2</span>
<span class="go">Usage: ./sphinx.pex [options] sourcedir outdir [filenames...]</span>

<span class="go">General options</span>
<span class="go">^^^^^^^^^^^^^^^</span>
<span class="go">-b &lt;builder&gt;  builder to use; default is html</span>
<span class="go">-a            write all files; default is to only write new and changed files</span>
<span class="go">-E            don&#39;t use a saved environment, always read all files</span>
<span class="go">...</span>
</pre></div>
</div>
<p>和以前一样，进入点不是必须的，如果没有指定，PEX 将默认为直接进入一个解释器。如果用 <code class="docutils literal notranslate"><span class="pre">--python</span></code> 指定了另一个解释器，例如 pypy，它将成为 PEX 文件中默认的 hashbang：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pex --python<span class="o">=</span>pypy flask -o flask-pypy.pex
</pre></div>
</div>
<p>The hashbang of the PEX file specifies PyPy:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>head -1 flask-pypy.pex
<span class="gp">#</span>!/usr/bin/env pypy
</pre></div>
</div>
<p>and when invoked uses the environment PyPy:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./flask-pypy.pex
<span class="go">Python 2.7.3 (87aa9de10f9c, Nov 24 2013, 20:57:21)</span>
<span class="go">[PyPy 2.2.1 with GCC 4.2.1 Compatible Apple LLVM 5.0 (clang-500.2.79)] on darwin</span>
<span class="go">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span>
<span class="gp gp-VirtualEnv">(InteractiveConsole)</span>
<span class="go">&gt;&gt;&gt; import flask</span>
</pre></div>
</div>
<p>To specify an explicit Python shebang line (e.g. from a non-standard location or not on $PATH),
you can use the <code class="docutils literal notranslate"><span class="pre">--python-shebang</span></code> option:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dist/pex --python-shebang<span class="o">=</span><span class="s1">&#39;/Users/wickman/Python/CPython-3.4.2/bin/python3.4&#39;</span> -o my.pex
<span class="gp">$ </span>head -1 my.pex
<span class="gp">#</span>!/Users/wickman/Python/CPython-3.4.2/bin/python3.4
</pre></div>
</div>
<p>Furthermore, this can be manipulated at runtime using the <code class="docutils literal notranslate"><span class="pre">PEX_PYTHON</span></code> environment variable.</p>
</section>
<section id="tailoring-requirement-resolution">
<h2>Tailoring requirement resolution<a class="headerlink" href="#tailoring-requirement-resolution" title="永久链接至标题">¶</a></h2>
<p>In general, <code class="docutils literal notranslate"><span class="pre">pex</span></code> honors the same options as pip when it comes to resolving packages.  Like pip,
by default <code class="docutils literal notranslate"><span class="pre">pex</span></code> fetches artifacts from PyPI.  This can be disabled with <code class="docutils literal notranslate"><span class="pre">--no-index</span></code>.</p>
<p>If PyPI fetching is disabled, you will need to specify a search repository via <code class="docutils literal notranslate"><span class="pre">-f/--find-links</span></code>.
This may be a directory on disk or a remote simple http server.</p>
<p>For example, you can delegate artifact fetching and resolution to <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">wheel</span></code> for whatever
reason – perhaps you’re running a firewalled mirror – but continue to package with pex:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip wheel -w /tmp/wheelhouse sphinx sphinx_rtd_theme
<span class="gp">$ </span>pex -f /tmp/wheelhouse --no-index -e sphinx:main -o sphinx.pex sphinx sphinx_rtd_theme
</pre></div>
</div>
</section>
<section id="tailoring-pex-execution-at-build-time">
<h2>Tailoring PEX execution at build time<a class="headerlink" href="#tailoring-pex-execution-at-build-time" title="永久链接至标题">¶</a></h2>
<p>There are a few options that can tailor how PEX environments are invoked.  These can be found
by running <code class="docutils literal notranslate"><span class="pre">pex</span> <span class="pre">--help</span></code>.  Every flag mentioned here has a corresponding environment variable
that can be used to override the runtime behavior which can be set directly in your environment,
or sourced from a <code class="docutils literal notranslate"><span class="pre">.pexrc</span></code> file (checking for <code class="docutils literal notranslate"><span class="pre">~/.pexrc</span></code> first, then for a relative <code class="docutils literal notranslate"><span class="pre">.pexrc</span></code>).</p>
<section id="zip-safe-not-zip-safe">
<h3><code class="docutils literal notranslate"><span class="pre">--zip-safe</span></code>/<code class="docutils literal notranslate"><span class="pre">--not-zip-safe</span></code><a class="headerlink" href="#zip-safe-not-zip-safe" title="永久链接至标题">¶</a></h3>
<p>Whether or not to treat the environment as zip-safe.  By default PEX files are listed as zip safe.
If <code class="docutils literal notranslate"><span class="pre">--not-zip-safe</span></code> is specified, the source of the PEX will be written to disk prior to
invocation rather than imported via the zipimporter.  NOTE: Distribution zip-safe bits will still
be honored even if the PEX is marked as zip-safe.  For example, included .eggs may be marked as
zip-safe and invoked without the need to write to disk.  Wheels are always marked as not-zip-safe
and written to disk prior to PEX invocation.  <code class="docutils literal notranslate"><span class="pre">--not-zip-safe</span></code> forces <code class="docutils literal notranslate"><span class="pre">--always-write-cache</span></code>.</p>
</section>
<section id="always-write-cache">
<h3><code class="docutils literal notranslate"><span class="pre">--always-write-cache</span></code><a class="headerlink" href="#always-write-cache" title="永久链接至标题">¶</a></h3>
<p>Always write all packaged dependencies within the PEX to disk prior to invocation.  This forces the zip-safe
bit of any dependency to be ignored.</p>
</section>
<section id="inherit-path">
<h3><code class="docutils literal notranslate"><span class="pre">--inherit-path</span></code><a class="headerlink" href="#inherit-path" title="永久链接至标题">¶</a></h3>
<p>By default, PEX environments are completely scrubbed empty of any packages installed on the global site path.
Setting <code class="docutils literal notranslate"><span class="pre">--inherit-path</span></code> allows packages within site-packages to be considered as candidate distributions
to be included for the execution of this environment.  This is strongly discouraged as it circumvents one of
the biggest benefits of using .pex files, however there are some cases where it can be advantageous (for example
if a package does not package correctly an an egg or wheel.)</p>
</section>
<section id="ignore-errors">
<h3><code class="docutils literal notranslate"><span class="pre">--ignore-errors</span></code><a class="headerlink" href="#ignore-errors" title="永久链接至标题">¶</a></h3>
<p>If not all of the PEX environment’s dependencies resolve correctly (e.g. you are overriding the current
Python interpreter with <code class="docutils literal notranslate"><span class="pre">PEX_PYTHON</span></code>) this forces the PEX file to execute despite this.  Can be useful
in certain situations when particular extensions may not be necessary to run a particular command.</p>
</section>
<section id="platform">
<h3><code class="docutils literal notranslate"><span class="pre">--platform</span></code><a class="headerlink" href="#platform" title="永久链接至标题">¶</a></h3>
<p>The (abbreviated) platform to build the PEX for. This will look for wheels for the particular
platform.</p>
<p>The abbreviated platform is described by a string of the form <code class="docutils literal notranslate"><span class="pre">PLATFORM-IMPL-PYVER-ABI</span></code>, where
<code class="docutils literal notranslate"><span class="pre">PLATFORM</span></code> is the platform (e.g. <code class="docutils literal notranslate"><span class="pre">linux-x86_64</span></code>, <code class="docutils literal notranslate"><span class="pre">macosx-10.4-x86_64</span></code>), <code class="docutils literal notranslate"><span class="pre">IMPL</span></code> is the python
implementation abbreviation (<code class="docutils literal notranslate"><span class="pre">cp</span></code> or <code class="docutils literal notranslate"><span class="pre">pp</span></code>), <code class="docutils literal notranslate"><span class="pre">PYVER</span></code> is either a two or more digit string
representing the python version (e.g., <code class="docutils literal notranslate"><span class="pre">36</span></code> or <code class="docutils literal notranslate"><span class="pre">310</span></code>) or else a component dotted version
string (e.g., <code class="docutils literal notranslate"><span class="pre">3.6</span></code> or <code class="docutils literal notranslate"><span class="pre">3.10.1</span></code>) and <code class="docutils literal notranslate"><span class="pre">ABI</span></code> is the ABI tag (e.g., <code class="docutils literal notranslate"><span class="pre">cp36m</span></code>, <code class="docutils literal notranslate"><span class="pre">cp27mu</span></code>,
<code class="docutils literal notranslate"><span class="pre">abi3</span></code>, <code class="docutils literal notranslate"><span class="pre">none</span></code>). A complete example: <code class="docutils literal notranslate"><span class="pre">linux_x86_64-cp-36-cp36m</span></code>.</p>
<p><strong>Constraints</strong>: when <code class="docutils literal notranslate"><span class="pre">--platform</span></code> is used the
<a class="reference external" href="https://www.python.org/dev/peps/pep-0508/#environment-markers">environment marker</a>
<code class="docutils literal notranslate"><span class="pre">python_full_version</span></code> will not be available if <code class="docutils literal notranslate"><span class="pre">PYVER</span></code> is not given as a three component dotted
version since <code class="docutils literal notranslate"><span class="pre">python_full_version</span></code> is meant to have 3 digits (e.g., <code class="docutils literal notranslate"><span class="pre">3.8.10</span></code>). If a
<code class="docutils literal notranslate"><span class="pre">python_full_version</span></code> environment marker is encountered during a resolve, an
<code class="docutils literal notranslate"><span class="pre">UndefinedEnvironmentName</span></code> exception will be raised. To remedy this, either specify the full
version in the platform (e.g, <code class="docutils literal notranslate"><span class="pre">linux_x86_64-cp-3.8.10-cp38</span></code>) or use <code class="docutils literal notranslate"><span class="pre">--complete-platform</span></code>
instead.</p>
</section>
<section id="complete-platform">
<h3><code class="docutils literal notranslate"><span class="pre">--complete-platform</span></code><a class="headerlink" href="#complete-platform" title="永久链接至标题">¶</a></h3>
<p>The completely specified platform to build the PEX for. This will look for wheels for the particular
platform.</p>
<p>The complete platform can be either a path to a file containing JSON data or else a JSON object
literal. In either case, the JSON object is expected to have two fields with any other fields
ignored. The <code class="docutils literal notranslate"><span class="pre">marker_environment</span></code> field should have an object value with string field values
corresponding to
<a class="reference external" href="https://www.python.org/dev/peps/pep-0508/#environment-markers">PEP-508 marker environment</a>
entries. It is OK to only have a subset of valid marker environment fields but it is not valid to
present entries not defined in PEP-508. The <code class="docutils literal notranslate"><span class="pre">compatible_tags</span></code> field should have an array of
strings value containing the compatible tags in order from most specific first to least
specific last as defined in <a class="reference external" href="https://www.python.org/dev/peps/pep-0425">PEP-425</a>. Pex can create
complete platform JSON for you by running it on the target platform like so:
<code class="docutils literal notranslate"><span class="pre">pex3</span> <span class="pre">interpreter</span> <span class="pre">inspect</span> <span class="pre">--markers</span> <span class="pre">--tags</span></code>. For more options, particularly to select the desired
target interpreter see: <code class="docutils literal notranslate"><span class="pre">pex3</span> <span class="pre">interpreter</span> <span class="pre">inspect</span> <span class="pre">--help</span></code>.</p>
</section>
</section>
<section id="tailoring-pex-execution-at-runtime">
<h2>Tailoring PEX execution at runtime<a class="headerlink" href="#tailoring-pex-execution-at-runtime" title="永久链接至标题">¶</a></h2>
<p>Tailoring of PEX execution can be done at runtime by setting various environment variables.
The source of truth for these environment variables can be found in the
<a class="reference external" href="api/index.html#module-pex.variables">pex.variables API</a>.</p>
</section>
</section>
<section id="using-bdist-pex">
<h1>Using <code class="docutils literal notranslate"><span class="pre">bdist_pex</span></code><a class="headerlink" href="#using-bdist-pex" title="永久链接至标题">¶</a></h1>
<p>pex provides a convenience command for use in setuptools.  <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span>
<span class="pre">bdist_pex</span></code> is a simple way to build executables for Python projects that
adhere to standard naming conventions.</p>
<section id="bdist-pex">
<h2><code class="docutils literal notranslate"><span class="pre">bdist_pex</span></code><a class="headerlink" href="#bdist-pex" title="永久链接至标题">¶</a></h2>
<p>The default behavior of <code class="docutils literal notranslate"><span class="pre">bdist_pex</span></code> is to build an executable using the
console script of the same name as the package.  For example, pip has three
entry points: <code class="docutils literal notranslate"><span class="pre">pip</span></code>, <code class="docutils literal notranslate"><span class="pre">pip2</span></code> and <code class="docutils literal notranslate"><span class="pre">pip2.7</span></code> if you’re using Python 2.7.  Since
there exists an entry point named <code class="docutils literal notranslate"><span class="pre">pip</span></code> in the <code class="docutils literal notranslate"><span class="pre">console_scripts</span></code> section
of the entry points, that entry point is chosen and an executable pex is produced.  The pex file
will have the version number appended, e.g. <code class="docutils literal notranslate"><span class="pre">pip-7.2.0.pex</span></code>.</p>
<p>If no console scripts are provided, or the only console scripts available do
not bear the same name as the package, then an environment pex will be
produced.  An environment pex is a pex file that drops you into an
interpreter with all necessary dependencies but stops short of invoking a
specific module or function.</p>
</section>
<section id="bdist-pex-bdist-all">
<h2><code class="docutils literal notranslate"><span class="pre">bdist_pex</span> <span class="pre">--bdist-all</span></code><a class="headerlink" href="#bdist-pex-bdist-all" title="永久链接至标题">¶</a></h2>
<p>If you would like to build all the console scripts defined in the package instead of
just the namesake script, <code class="docutils literal notranslate"><span class="pre">--bdist-all</span></code> will write all defined entry_points but omit
version numbers and the <code class="docutils literal notranslate"><span class="pre">.pex</span></code> suffix.  This can be useful if you would like to
virtually install a Python package somewhere on your <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> without doing something
scary like <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">pip</span> <span class="pre">install</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git clone https://github.com/sphinx-doc/sphinx <span class="o">&amp;&amp;</span> <span class="nb">cd</span> sphinx
<span class="gp">$ </span>python setup.py bist_pex --bdist-all --bdist-dir<span class="o">=</span><span class="nv">$HOME</span>/bin
<span class="go">running bdist_pex</span>
<span class="go">Writing sphinx-apidoc to /Users/wickman/bin/sphinx-apidoc</span>
<span class="go">Writing sphinx-build to /Users/wickman/bin/sphinx-build</span>
<span class="go">Writing sphinx-quickstart to /Users/wickman/bin/sphinx-quickstart</span>
<span class="go">Writing sphinx-autogen to /Users/wickman/bin/sphinx-autogen</span>
<span class="gp">$ </span>sphinx-apidoc --help <span class="p">|</span> head -1
<span class="go">Usage: sphinx-apidoc [options] -o &lt;output_path&gt; &lt;module_path&gt; [exclude_path, ...]</span>
</pre></div>
</div>
</section>
</section>
<section id="using-pants">
<h1>Using Pants<a class="headerlink" href="#using-pants" title="永久链接至标题">¶</a></h1>
<p>The Pants build system can build pex files. See <a class="reference external" href="http://www.pantsbuild.org">here</a> for details.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="whatispex.html" class="btn btn-neutral float-left" title="什么是 .pex 文件？" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="recipes.html" class="btn btn-neutral float-right" title="PEX Recipes and Notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2022, Pants project contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>